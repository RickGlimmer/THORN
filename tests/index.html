<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <style>
        .pass {
            background-color: #00ff90;
        }
        .fail {
            background-color: #e97070;
        }
    </style>
    <script src="../scripts/THORN/THORN.js"></script>
    <script src="../scripts/THORN/properties/properties.js"></script>
    <script src="../scripts/THORN/chainables/selectors.js"></script>
    <script src="../scripts/THORN/chainables/events.js"></script>
    <script src="../scripts/THORN/chainables/appearance.js"></script>
    <script src="../scripts/THORN/chainables/content.js"></script>
    <script type="text/javascript">
        þ.extend('THORN', {

            loadPlugins: function (elem) {
                if (!elem) return;
                þ(elem || document.body).find('[data-plugin]').each(function () {
                    var þthis = þ(this);
                    var plugin = this.dataset.plugin;
                    if (plugin != null) {
                        þ.plugins[plugin](this);
                        if (typeof þ.plugins[plugin] == 'object' && typeof þ.plugins[plugin].start == 'function')
                            þ.plugins[plugin].start();
                    }
                }, true); // get raw Nodes
            },

            guid: function () {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
                    .replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0,
                                v = c == 'x' ? r : r & 0x3 | 0x8;
                        return v.toString(16);
                    });
            }
        });

        þ.addPlugin({
            TESTPLUGIN: function (elem) {
                var info = {
                    namespace: "com.tzadvantage.OSM",
                    author: "TZ Advantage Ltd.",
                    version: "1.0",
                    date: "2015-01-17 05:00+07:00"
                }

                var settings = {};

                //this.start = function () { alert("Hallo"); }

                TESTPLUGIN(elem);
                return;

                //Instance for every html node
                function TESTPLUGIN(elem) {
                    var me = elem;
                    var þMe = þ(me);
                    var data = me.dataset;

                    þMe
                        .bind('click', function (e) {
                            þMe.innerHTML = 'clicked';
                            þMe.style({ backgroundColor: 'yellow' });
                        })
                        .bind('testme', function (e) {
                            var text = e.detail || "{no detail}";
                            var o = þMe.html(text);
                            o.style({ backgroundColor: 'cyan' });
                        });


                }
            }
        });
    </script>
    <title></title>
</head>
<body>
    <h5>Plugin:</h5>
    <div data-plugin="TESTPLUGIN">Click to change background color to yellow</div>
    <button id="runtests">Run All Tests</button>
    <hr />
    <ul id="testoutput"></ul>
</body>
<script type="text/javascript">
    þ.ready(function (event) {
        þ('#runtests').bind('click', function (e) {
            þ('[data-plugin]').fire('testme', "fire('testme')!");
        });

        var output = document.getElementById('testoutput');

        function assert(outcome, description) {
            var li = document.createElement('li');
            li.className = outcome ? 'pass' : 'fail';
            li.appendChild(document.createTextNode(description));

            output.appendChild(li);
        };

        assert((
                function () {
                    var b = þ('body');
                    return (b.length == 1 && b.nodes[0].tagName == 'BODY');
                }
                )(), "þ('body')");



    });
</script>
</html>
